{"version":3,"sources":["theme.tsx","api/AppApi.tsx","state/weather-state.tsx","App.tsx","serviceWorker.ts","locale/i18n.tsx","locale/en.tsx","locale/de.tsx","index.tsx"],"names":["theme","colorPrimary","colorSecondary","textPrimary","textSecondary","background","AppApi","WeatherAPIKey","this","process","fetch","response","json","data","cities","records","map","r","name","fields","accentcity","country","region","sort","a","b","localeCompare","console","log","cityName","url","weather","city","location","current","last_updated_epoch","last_updated","temp_c","temp_f","is_day","condition","text","icon","code","wind_mph","wind_kph","wind_degree","wind_dir","pressure_mb","pressure_in","precip_mm","precip_in","humidity","cloud","feelslike_c","feelslike_f","vis_km","vis_miles","uv","gust_mph","gust_kph","updated_at","Date","lat","lon","query","c","WeatherState","types","model","number","string","actions","self","CityState","id","identifier","currentWeather","maybeNull","views","isUpdated","now","getTime","isFavorite","getParentOfType","AppState","favoriteCities","findIndex","setCurrentWeather","create","LookupResultState","topCities","array","reference","lookup","optional","lookupResult","findCity","get","addToTopCity","index","push","splice","removeFromTopCity","setTopCities","clear","forEach","cityRef","put","addToFavorite","removeFromFavorite","addCityWeather","removeCityWeather","delete","setLookupResult","result","setLookup","getEnv","api","fetchLookup","undefined","updateCurrentWeather","Promise","all","values","fetchWeatherForCity","addedCity","init","length","fetchTopCities","fetchCity","storeContext","React","createContext","AppStateProvider","children","store","useLocalStore","createStore","Provider","value","useAppState","useContext","Error","appStore","localStorage","getItem","injection","JSON","parse","err","error","onSnapshot","snapshot","setItem","stringify","NoMatch","lazy","Home","CityWeather","useStyles","createUseStyles","html","backgroundColor","body","margin","fontFamily","App","useTheme","path","DefaultLoadingIndicator","Boolean","window","hostname","match","resources","en","translation","de","i18n","use","initReactI18next","lng","interpolation","escapeValue","ReactDOM","render","StrictMode","fallback","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.ed415a65.chunk.js","sourcesContent":["export { createUseStyles, useTheme } from 'react-jss';\n\nexport const theme = {\n  colorPrimary: \"green\",\n  colorSecondary: \"red\",\n  textPrimary: \"#ccc\",\n  textSecondary: \"#eee\",\n  background: '#eee',\n}\n\nexport type Theme = typeof theme;\n\n","\nexport interface IWeatherData {\n  city: ICity,\n  current: {\n    \"last_updated_epoch\": number,\n    \"last_updated\": string,\n    \"temp_c\": number,\n    \"temp_f\": number,\n    \"is_day\": number,\n    \"condition\": {\n      \"text\": string,\n      \"icon\": string,\n      \"code\": number,\n    },\n    \"wind_mph\": number,\n    \"wind_kph\": number,\n    \"wind_degree\": number,\n    \"wind_dir\": string,\n    \"pressure_mb\": number,\n    \"pressure_in\": number,\n    \"precip_mm\": number,\n    \"precip_in\": number,\n    \"humidity\": number,\n    \"cloud\": number,\n    \"feelslike_c\": number,\n    \"feelslike_f\": number,\n    \"vis_km\": number,\n    \"vis_miles\": number,\n    \"uv\": number,\n    \"gust_mph\": number,\n    \"gust_kph\": number,\n    updated_at: Date,\n  }\n}\n\nexport interface ICity {\n  name: string,\n  country: string,\n  region: string,\n}\n\nexport class AppApi {\n  private WeatherAPIKey: string;\n\n  constructor() {\n    // Setting api key in front-end is a bad practice and not secure,\n    // but as the requirement is to avoid having back-end there is no other way \n    this.WeatherAPIKey = process.env.REACT_APP_WEATHERAPI_API_KEY || '';\n  }\n\n  async fetchTopCities(): Promise<ICity[] | undefined> {\n    const url = `https://public.opendatasoft.com/api/records/1.0/search/?dataset=worldcitiespop&q=&rows=15&sort=population&facet=country`;\n    try {\n      const response = await fetch(url);\n      const data = await response.json() as { records: any[] };\n      const cities = data?.records?.map((r: any) => ({\n        name: (r?.fields?.accentcity || r?.fields?.name) as string,\n        country: r?.fields?.country as string,\n        region: r?.fields?.region as string,\n      })).sort((a, b) => a.name.localeCompare(b.name));\n      return cities;\n    } catch (err) {\n      console.log(err);\n    }\n  }\n\n  async fetchWeatherForCity(cityName: string): Promise<IWeatherData | undefined> {\n    const url = `https://api.weatherapi.com/v1/current.json?key=${this.WeatherAPIKey}&q=${cityName}`;\n    // docs under https://www.weatherapi.com/api-explorer.aspx\n    try {\n      const response = await fetch(url);\n      const data = await response.json();\n      const weather = {\n        city: {\n          name: data.location.name,\n          country: data.location.country,\n          region: data.location.region,\n        },\n        current: {\n          \"last_updated_epoch\": data.current.last_updated_epoch,\n          \"last_updated\": data.current.last_updated,\n          \"temp_c\": data.current.temp_c,\n          \"temp_f\": data.current.temp_f,\n          \"is_day\": data.current.is_day,\n          \"condition\": {\n            \"text\": data.current.condition.text,\n            \"icon\": data.current.condition.icon,\n            \"code\": data.current.condition.code,\n          },\n          \"wind_mph\": data.current.wind_mph,\n          \"wind_kph\": data.current.wind_kph,\n          \"wind_degree\": data.current.wind_degree,\n          \"wind_dir\": data.current.wind_dir,\n          \"pressure_mb\": data.current.pressure_mb,\n          \"pressure_in\": data.current.pressure_in,\n          \"precip_mm\": data.current.precip_mm,\n          \"precip_in\": data.current.precip_in,\n          \"humidity\": data.current.humidity,\n          \"cloud\": data.current.cloud,\n          \"feelslike_c\": data.current.feelslike_c,\n          \"feelslike_f\": data.current.feelslike_f,\n          \"vis_km\": data.current.vis_km,\n          \"vis_miles\": data.current.vis_miles,\n          \"uv\": data.current.uv,\n          \"gust_mph\": data.current.gust_mph,\n          \"gust_kph\": data.current.gust_kph,\n          updated_at: new Date(),\n        }\n      };\n      return weather;\n    } catch (err) {\n      console.log(err);\n    }\n  }\n\n  async fetchWeatherForLocation(lat: number, lon: number): Promise<IWeatherData | undefined> {\n    const url = `https://api.weatherapi.com/v1/current.json?key=${this.WeatherAPIKey}&query=${lat},${lon}`;\n    return;\n  }\n\n  async fetchWeatherForMyIP(): Promise<IWeatherData | undefined> {\n    const url = `https://api.weatherapi.com/v1/current.json?key=${this.WeatherAPIKey}&query=fetch:ip`;\n    return;\n  }\n\n  async fetchLookup(query: string): Promise<ICity[] | undefined> {\n    const url = `https://api.weatherapi.com/v1/search.json?key=${this.WeatherAPIKey}&q=${query}`;\n    try {\n      const response = await fetch(url);\n      const data = await response.json() as any[];\n      const cities = data.map( c => ({\n        name: c.name,\n        region: c.region,\n        country: c.country,\n      }));\n      return cities;\n    } catch (err) {\n      console.log(err);\n    }\n  }\n\n}","import React from 'react';\nimport { useLocalStore } from 'mobx-react-lite';\nimport { types, Instance, SnapshotIn, onSnapshot, getParentOfType, getEnv } from \"mobx-state-tree\";\nimport { AppApi, ICity, IWeatherData } from '../api/AppApi';\n\nconst WeatherDataTTL = 10 * 60 * 1000;\n\nexport const WeatherState = types\n  .model(\"WeatherState\", {\n    \"last_updated_epoch\": types.number,\n    \"last_updated\": types.string,\n    \"temp_c\": types.number,\n    \"temp_f\": types.number,\n    \"is_day\": types.number,\n    \"condition\": types.model({\n        \"text\": types.string,\n        \"icon\": types.string,\n        \"code\": types.number,\n    }),\n    \"wind_mph\": types.number,\n    \"wind_kph\": types.number,\n    \"wind_degree\": types.number,\n    \"wind_dir\": types.string,\n    \"pressure_mb\": types.number,\n    \"pressure_in\": types.number,\n    \"precip_mm\": types.number,\n    \"precip_in\": types.number,\n    \"humidity\": types.number,\n    \"cloud\": types.number,\n    \"feelslike_c\": types.number,\n    \"feelslike_f\": types.number,\n    \"vis_km\": types.number,\n    \"vis_miles\": types.number,\n    \"uv\": types.number,\n    \"gust_mph\": types.number,\n    \"gust_kph\": types.number,\n    updated_at: types.Date,\n  })\n  .actions(self => {\n    return {\n    }\n  });\n\nexport const CityState = types\n  .model(\"CityState\", {\n    id: types.identifier,\n    name: types.string,\n    country: types.string,\n    region: types.string,\n    currentWeather: types.maybeNull(WeatherState),\n  })\n  .views(self => {\n    return {\n      isUpdated(now: Date){\n        return now.getTime() - (self.currentWeather?.updated_at.getTime() || 0) < WeatherDataTTL;\n      },\n      isFavorite(): boolean{\n        const parent = getParentOfType(self, AppState);\n        const index = parent.favoriteCities.findIndex( c => c === self);\n        return index !== -1;\n      },\n    }\n  })\n  .actions(self => {\n    return {\n      setCurrentWeather(weather: IWeatherData){\n        self.currentWeather = WeatherState.create(weather.current);\n      },\n    }\n  });\n\nexport const LookupResultState = types\n  .model(\"LookupResultState\", {\n    name: types.string,\n    country: types.string,\n    region: types.string,\n  });\n\nexport const AppState = types\n  .model(\"AppState\", {\n    topCities: types.array(types.reference(CityState)),\n    favoriteCities: types.array(types.reference(CityState)),\n    cities: types.map(CityState),\n    lookup: types.optional(types.string, ''),\n    lookupResult: types.array(LookupResultState),\n  })\n  .views(self => {\n    return {\n      findCity(country: string, region: string, name: string): ICityState | undefined{\n        const city = self.cities.get(`${country}/${region}/${name}`);\n        return city;\n      },\n    }\n  })\n  .actions(self => {\n    return {\n      addToTopCity(city: ICityState) {\n        const index = self.topCities.findIndex( c => c.name.localeCompare(city.name) > 0);\n        if(index === -1){\n          self.topCities.push(city);\n        }else{\n          self.topCities.splice(index, 0, city);\n        }\n      },\n      removeFromTopCity(city: ICityState) {\n        const index = self.topCities.findIndex( c => c === city);\n        if(index !== -1){\n          self.topCities.splice(index, 1);\n        }\n      },\n    }\n  })\n  .actions(self => {\n    return {\n      setTopCities(cities: ICity[]) {\n        self.topCities.clear();\n        cities.forEach( city => {\n          const cityRef = self.cities.put(CityState.create({\n            id: `${city.country}/${city.region}/${city.name}`,\n            name: city.name,\n            country: city.country,\n            region: city.region,\n          }));\n          if(!cityRef.isFavorite()){\n            self.topCities.push(cityRef);\n          }\n        });\n      },\n      addToFavorite(city: ICityState) {\n        const index = self.favoriteCities.findIndex( c => c.name.localeCompare(city.name) > 0);\n        if(index === -1){\n          self.favoriteCities.push(city);\n        }else{\n          self.favoriteCities.splice(index, 0, city);\n        }\n        self.removeFromTopCity(city);\n      },\n      removeFromFavorite(city: ICityState) {\n        const index = self.favoriteCities.findIndex( c => c === city);\n        if(index !== -1){\n          self.favoriteCities.splice(index, 1);\n        }\n      },\n      addCityWeather(weather: IWeatherData): ICityState{\n        const cityRef = self.cities.put(CityState.create({\n          id: `${weather.city.country}/${weather.city.region}/${weather.city.name}`,\n          name: weather.city.name,\n          country: weather.city.country,\n          region: weather.city.region,\n          currentWeather: WeatherState.create(weather.current),\n        }));\n        return cityRef;\n      },\n      removeCityWeather(city: ICityState){\n        self.cities.delete(city.id);\n      },\n      setLookupResult(result?: ICity[]){\n        self.lookupResult.clear();\n        result && self.lookupResult.push(...result);\n        console.log('lookup result set')\n      },\n    }\n  })\n  .actions(self => {\n    return {\n      async setLookup(query: string) {\n        self.lookup = query;\n        console.log('looking up')\n        if(query){\n          const result = await getEnv<EnvType>(self).api.fetchLookup(query);\n          if(self.lookup === query){\n            self.setLookupResult(result);\n            console.log('same qeury, setting')\n          }else{\n            console.log('not same qeury, ignoring')\n          }\n        }else{\n          console.log('empty query , make it empty')\n          self.setLookupResult(undefined);\n        }\n      },\n      async updateCurrentWeather(){\n        const api = getEnv<EnvType>(self).api;\n        const now = new Date();\n        await Promise.all([...self.cities.values()].map( async (city) => {\n          if(city.isUpdated(now)){\n            return;\n          }\n          const weather = await api.fetchWeatherForCity(city.name);\n          if(weather){\n            if(`${weather.city.country}/${weather.city.region}/${weather.city.name}` === city.id){\n              city.setCurrentWeather(weather);\n            }else{\n              const addedCity = self.addCityWeather(weather);\n              self.removeFromTopCity(city);\n              self.removeFromFavorite(city);\n              self.removeCityWeather(city);\n              self.addToTopCity(addedCity);\n            }\n          }\n        }));\n      },\n    }\n  })\n  .actions(self => {\n    return {\n      async init() {\n        if(!self.topCities?.length){\n          const cities = await getEnv<EnvType>(self).api.fetchTopCities();\n          if(cities){\n            self.setTopCities(cities);\n          }\n        }\n        await self.updateCurrentWeather();\n      },\n      async fetchCity(cityName: string){\n        const weather = await getEnv<EnvType>(self).api.fetchWeatherForCity(cityName);\n        if(weather){\n          self.addCityWeather(weather);\n        }\n      }\n    }\n  });\n\nconst storeContext = React.createContext<IAppState | null>(null);\n\nexport const AppStateProvider: React.FunctionComponent = ({ children }) => {\n  const store = useLocalStore(createStore)\n  return <storeContext.Provider value={store}>{children}</storeContext.Provider>\n}\n\nexport const useAppState = () => {\n  const store = React.useContext(storeContext)\n  if (!store) {\n    // this is especially useful in TypeScript so you don't need to be checking for null all the time\n    throw new Error('useStore must be used within a StoreProvider.')\n  }\n  return store\n}\n\nexport type EnvType = {\n  api: AppApi,\n}\n\nexport function createStore() {\n  const appStore = localStorage.getItem('app-store');\n\n  const injection: EnvType = {\n    api: new AppApi(),\n  }\n\n  let store;\n  try {\n    store = AppState.create(appStore ? JSON.parse(appStore) : emptyStore(), injection);\n  } catch (err) {\n    console.error('could not restore, with the following error. fallback to empty store.');\n    console.error(err);\n    store = AppState.create(emptyStore(), injection);\n  }\n  onSnapshot(store, snapshot => {\n    localStorage.setItem('app-store', JSON.stringify(snapshot));\n  });\n\n  return store;\n}\n\nfunction emptyStore(): IAppStateSnapshot {\n  return {};\n}\n\nexport interface IAppState extends Instance<typeof AppState> { };\nexport interface IAppStateSnapshot extends SnapshotIn<typeof AppState> { };\nexport interface ICityState extends Instance<typeof CityState> { };\nexport interface IWeatherState extends Instance<typeof WeatherState> { };","import React, { lazy } from 'react';\nimport {\n  BrowserRouter as Router,\n  Switch,\n  Route,\n} from \"react-router-dom\";\nimport { createUseStyles, useTheme, Theme } from './theme';\nimport { AppStateProvider } from './state/weather-state';\n\nconst NoMatch = lazy(() => import('./pages/NoMatch'));\nconst Home = lazy(() => import('./pages/Home'));\nconst CityWeather = lazy(() => import('./pages/CityWeather'));\n\nconst useStyles = createUseStyles<Theme>(theme => ({\n  '@global': {\n    html: {\n      backgroundColor: theme.background,\n    },\n    body: {\n      margin: 0,\n    },\n    'html *': {\n      fontFamily: 'Yekan Bakh',\n    },\n  },\n\n}));\n\nconst App: React.FC = () => {\n\n  const theme = useTheme();\n  useStyles({ theme });\n\n  return (\n    <AppStateProvider >\n      <Router>\n        <Switch>\n          <Route path=\"/city/:country/:region/:name\">\n            <CityWeather />\n          </Route>\n          <Route path=\"/\">\n            <Home />\n          </Route>\n          <Route path=\"*\">\n            <NoMatch />\n          </Route>\n        </Switch>\n      </Router>\n    </AppStateProvider>\n  );\n}\n\nexport default App;\n\nexport const DefaultLoadingIndicator = () => (\n  <div>\n    Loading...\n  </div>\n);\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import i18n from \"i18next\";\nimport { initReactI18next } from \"react-i18next\";\nimport { en } from \"./en\";\nimport { de } from \"./de\";\n\n// the translations\nconst resources = {\n  en,\n  de,\n};\n\ni18n\n  .use(initReactI18next) // passes i18n down to react-i18next\n  .init({\n    resources,\n    lng: \"en\",\n\n    interpolation: {\n      escapeValue: false, // react already safes from xss\n    }\n  });\n\n  export default i18n;","export const en = {\n  translation: {\n    \"ttest\": \"TWeathr Test\"\n  }\n}","export const de = {\n  translation: {\n    \"ttest\": \"Das wetter\"\n  }\n}","import React, { Suspense } from 'react';\nimport ReactDOM from 'react-dom';\nimport App, { DefaultLoadingIndicator } from './App';\nimport * as serviceWorker from './serviceWorker';\nimport { ThemeProvider } from 'react-jss';\nimport {theme} from './theme';\nimport './locale/i18n';\n\nReactDOM.render(\n  <React.StrictMode>\n    <ThemeProvider theme={theme}>\n      <Suspense fallback={<DefaultLoadingIndicator />}>\n        <App />\n      </Suspense>\n    </ThemeProvider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}